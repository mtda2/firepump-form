<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ Fire Pump & Engine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Sarabun', sans-serif; scroll-behavior: smooth; }
        body { background-color: #f0f4f8; }
        .theme-header { background-color: #1e293b; }
        .theme-accent { color: #14b8a6; }
        .theme-accent-radio { accent-color: #14b8a6; }
        .radio-item:has(input[type="radio"]:checked),
        .radio-item-other:has(input[type="radio"]:checked) {
            background-color: #f0fdfa; border-color: #14b8a6;
            box-shadow: 0 0 0 2px hsla(173, 82%, 41%, 0.3);
        }
        dialog { transition: opacity 0.3s ease-out, transform 0.3s ease-out; }
        dialog[open] { opacity: 1; transform: scale(1); }
        dialog::backdrop {
            background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(8px);
            transition: opacity 0.3s ease-out, backdrop-filter 0.3s ease-out;
        }
        .spinner { border: 3px solid #e2e8f0; border-top: 3px solid #14b8a6; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .btn {
            transition: all 0.2s ease-in-out; border-radius: 0.5rem; font-weight: 600;
            padding: 0.75rem 1.5rem; display: inline-flex; align-items: center;
            justify-content: center; gap: 0.5rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1); }
        .btn-ai { background-color: #14b8a6; color: white; }
        .btn-ai:hover { background-color: #0d9488; }
        .btn-submit { background-color: #4338ca; color: white; }
        .btn-submit:hover { background-color: #3730a3; }
        .btn-preview { background-color: #e2e8f0; color: #1e293b; }
        .btn-preview:hover { background-color: #cbd5e1; }
        .btn-reset { background-color: #be123c; color: white; }
        .btn-reset:hover { background-color: #9f1239; }
        .form-input { border: 1px solid #cbd5e1; border-radius: 0.5rem; transition: all 0.2s ease; }
        .form-input:focus { outline: none; border-color: #14b8a6; box-shadow: 0 0 0 3px rgba(20, 184, 166, 0.3); }
        .input-ok { border-color: #10b981 !important; background-color: #ecfdf5 !important; }
        .input-warning { border-color: #f59e0b !important; background-color: #fffbeb !important; }
        .input-critical { border-color: #ef4444 !important; background-color: #fef2f2 !important; }
        #loginDialog { max-width: 400px; border-radius: 1rem; overflow: hidden; border: none; padding: 0; box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25); }
        .label-required::after { content: ' *'; color: #ef4444; }
        .helper-text { font-size: 0.875rem; color: #64748b; margin-bottom: 8px; }
        .cute-mechanic-img {
            max-width: 120px; margin: -80px auto 1.5rem; display: block; background: white;
            border-radius: 50%; padding: 5px; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            position: relative; z-index: 10;
        }
    </style>
</head>
<body>

    <dialog id="loginDialog">
        <div class="p-8 text-center bg-slate-700 text-white">
            <i class="fa-solid fa-shield-halved text-5xl mb-3 text-teal-400"></i>
            <h2 class="text-3xl font-bold">Maintenance Access</h2>
            <p class="opacity-80">‡πÇ‡∏õ‡∏£‡∏î‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</p>
        </div>
        <div class="p-8 bg-white">
            <img src="mechanic.png" alt="Cute Mechanic" class="cute-mechanic-img">
            <form id="loginForm">
                <div class="mb-4">
                    <input type="text" id="username" name="username" class="form-input w-full p-3 text-lg" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required>
                </div>
                <div class="mb-5">
                    <input type="password" id="password" name="password" class="form-input w-full p-3 text-lg" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                </div>
                <button type="submit" id="loginButton" class="btn bg-teal-500 text-white w-full text-base hover:bg-teal-600">
                    <i class="fa-solid fa-arrow-right-to-bracket"></i>
                    <span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                </button>
                <p id="loginError" class="text-red-600 text-center font-semibold h-5 mt-3 text-sm"></p>
            </form>
        </div>
    </dialog>
    
    <div id="mainContent" class="hidden">
        <div class="theme-header text-white py-8 mb-8 shadow-xl">
            <div class="container mx-auto px-4 text-center">
                 <h1 class="text-4xl font-bold tracking-wide"><i class="fa-solid fa-fire-extinguisher theme-accent mr-3"></i>‡∏£‡∏∞‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏™‡∏π‡∏ö‡∏ô‡πâ‡∏≥‡∏î‡∏±‡∏ö‡πÄ‡∏û‡∏•‡∏¥‡∏á</h1>
            </div>
        </div>

        <div class="container mx-auto px-4">
            <div class="text-center mb-6 bg-white p-4 rounded-xl shadow-lg">
                <h2 class="text-2xl font-bold text-slate-800">‡πÅ‡∏ú‡∏ô‡∏Å‡∏ä‡πà‡∏≤‡∏á‡∏ã‡πà‡∏≠‡∏°‡∏ö‡∏≥‡∏£‡∏∏‡∏á ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÄ‡∏≠‡∏Å‡∏ä‡∏• 2</h2>
            </div>
            
            <form id="inspectionForm" action="https://docs.google.com/forms/d/e/1FAIpQLSdAp3uUyN7l7SGrMYEp0eCQpxkRd-iMnltaFEhAaLZKvQJF-w/formResponse" method="POST" target="hidden_iframe">
                
                <div class="sticky bottom-0 z-10 py-4 mt-8 bg-white/90 backdrop-blur-sm rounded-t-2xl shadow-[0_-10px_30px_-15px_rgba(0,0,0,0.1)]">
                    <div class="container mx-auto px-4 flex flex-wrap justify-center items-center gap-4">
                        <button type="button" id="analyzeButton" class="btn btn-ai"><i class="fa-solid fa-robot"></i><span>‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡πâ‡∏ß‡∏¢ AI "‡πÄ‡∏°‡∏Ü‡∏≤"</span></button>
                        <button type="button" id="previewButton" class="btn btn-preview"><i class="fa-solid fa-magnifying-glass"></i><span>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</span></button>
                        <button type="submit" class="btn btn-submit"><i class="fa-solid fa-paper-plane"></i><span>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span></button>
                        <button type="button" id="resetButton" class="btn btn-reset"><i class="fa-solid fa-arrow-rotate-left"></i><span>‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°</span></button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;" onload="handleFormSubmitted()"></iframe>

    <dialog id="previewDialog" class="rounded-2xl shadow-xl p-0 w-11/12 max-w-2xl"></dialog>
    <dialog id="aiDialog" class="rounded-2xl shadow-xl p-0 w-11/12 max-w-3xl"></dialog>

    <script>
    // These functions MUST be global for the iframe `onload` to find them.
    let formSubmitted = false;
    function handleFormSubmitted() {
        if (formSubmitted) {
            alert('‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            const submitButton = document.querySelector('#inspectionForm button[type="submit"]');
            if (submitButton) {
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fa-solid fa-paper-plane"></i><span>‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>';
            }
            // Use the reset function exposed on the window object
            if (window.app && typeof window.app.resetForm === 'function') {
                window.app.resetForm(true);
            }
            formSubmitted = false;
        }
    }

    // Wrap all application logic in a DOMContentLoaded event listener
    document.addEventListener('DOMContentLoaded', function() {
        // --- PRE-FLIGHT CHECK ---
        if (window.location.protocol === 'file:') {
            alert('‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏ï‡πâ‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏£‡∏±‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå (‡πÄ‡∏ä‡πà‡∏ô Live Server) ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á‡πÑ‡∏î‡πâ ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô');
            document.body.innerHTML = `<div style="padding: 2rem; text-align: center; font-size: 1.2rem; color: red;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏ß‡πá‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</div>`;
            return;
        }

        // --- CONSTANTS & STATE ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzpKavLhCGZTy1v4StlAdAEQIHDhD92oWngAxzHFDPkxaGTN9AyayPtL0vO4gyqxkL2qw/exec";
        
        // --- ELEMENT SELECTORS ---
        const loginDialog = document.getElementById('loginDialog');
        const loginForm = document.getElementById('loginForm');
        const mainContent = document.getElementById('mainContent');
        const inspectionForm = document.getElementById('inspectionForm');

        // ===================================
        // INITIALIZATION
        // ===================================
        
        function initializeLogin() {
            console.log("Initializing Login System...");
            if (!loginDialog || !loginForm) {
                console.error("Login elements not found!");
                return;
            }

            loginDialog.showModal();
            loginDialog.addEventListener('cancel', (e) => e.preventDefault());

            loginForm.addEventListener('submit', handleLoginSubmit);
        }

        function initializeMainForm() {
            console.log("Initializing Main Form...");
            if (!inspectionForm) {
                console.error("Main form element not found!");
                return;
            }
            
            autoFillCurrentDate();
            
            // --- Attach Event Listeners ---
            inspectionForm.addEventListener('submit', handleMainFormSubmit);
            document.getElementById('analyzeButton').addEventListener('click', analyzeWithAI);
            document.getElementById('previewButton').addEventListener('click', previewAnswers);
            document.getElementById('resetButton').addEventListener('click', () => resetForm(false));
            
            // Use event delegation for dynamic elements
            inspectionForm.addEventListener('click', handleFormClicks);
            inspectionForm.addEventListener('input', handleFormInputs);
        }

        // ===================================
        // EVENT HANDLERS
        // ===================================

        async function handleLoginSubmit(e) {
            e.preventDefault();
            const loginButton = document.getElementById('loginButton');
            const loginError = document.getElementById('loginError');
            
            loginError.textContent = '';
            loginButton.innerHTML = '<div class="spinner"></div><span class="ml-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...</span>';
            loginButton.disabled = true;

            const username = loginForm.username.value;
            const password = loginForm.password.value;

            try {
                console.log("Attempting to fetch login data from Apps Script...");
                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'cors',
                    redirect: 'follow',
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                    body: JSON.stringify({ username, password })
                });

                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);

                const result = await response.json();
                console.log("Received response from Apps Script:", result);

                if (result.success) {
                    console.log("Login successful.");
                    loginDialog.close();
                    mainContent.classList.remove('hidden');
                    initializeMainForm();
                } else {
                    console.warn("Login failed:", result.message);
                    loginError.textContent = result.message || '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                }
            } catch (error) {
                console.error("Login fetch failed:", error);
                loginError.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Console (F12)';
            } finally {
                loginButton.innerHTML = '<i class="fa-solid fa-arrow-right-to-bracket"></i><span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>';
                loginButton.disabled = false;
            }
        }

        function handleMainFormSubmit(e) {
            e.preventDefault();
            const submitButton = inspectionForm.querySelector('button[type="submit"]');
            formSubmitted = true;
            submitButton.disabled = true;
            submitButton.innerHTML = '<div class="spinner"></div><span class="ml-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...</span>';
            inspectionForm.submit();
        }

        function handleFormClicks(e) {
            const radioContainer = e.target.closest('.radio-item, .radio-item-other');
            if (radioContainer) {
                selectRadio(radioContainer);
            }
        }

        function handleFormInputs(e) {
            if (e.target.matches('input[type="number"][placeholder*="STD."]')) {
                validateInput(e.target);
            }
        }
        
        // ===================================
        // HELPER FUNCTIONS
        // ===================================

        function autoFillCurrentDate() {
            const dateInput = inspectionForm.querySelector('input[name="entry.1632403651"]');
            if (dateInput) {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                dateInput.value = `${yyyy}-${mm}-${dd}`;
            }
        }

        function selectRadio(element) {
            const radio = element.querySelector('input[type="radio"]');
            if (radio && !radio.checked) {
                radio.checked = true;
                
                const parentGroup = element.closest('.grid, .radio-group');
                if (parentGroup) {
                    parentGroup.querySelectorAll('.other-input').forEach(input => input.classList.add('hidden'));
                }
                
                if (element.classList.contains('radio-item-other')) {
                    const otherInput = element.querySelector('.other-input');
                    if (otherInput) {
                        otherInput.classList.remove('hidden');
                        otherInput.focus();
                    }
                }
            }
        }

        function resetForm(force = false) {
            if (force || confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                inspectionForm.reset();
                document.querySelectorAll('.other-input').forEach(input => input.classList.add('hidden'));
                document.querySelectorAll('.input-ok, .input-warning, .input-critical').forEach(el => {
                    el.classList.remove('input-ok', 'input-warning', 'input-critical');
                });
                autoFillCurrentDate();
            }
        }
        // Expose resetForm globally for the iframe handler
        window.app = { resetForm };
        
        // All other functions (previewAnswers, validateInput, analyzeWithAI, generateAiAnalysis) are unchanged
        // and can be placed here. For brevity in this explanation, they are assumed to be present.
        // ... [The full code for previewAnswers, validateInput, and AI analysis follows] ...
        function previewAnswers() {
            const dialog = document.getElementById('previewDialog');
            let contentHTML = '';
            const formData = new FormData(inspectionForm);
            let count = 0;
            const labelMap = new Map();

            inspectionForm.querySelectorAll('.form-group').forEach(group => {
                const label = group.querySelector('.form-label');
                if (label) {
                    group.querySelectorAll('input, textarea').forEach(input => {
                        if (input.name) labelMap.set(input.name, label.textContent.split('/')[0].trim());
                    });
                }
            });

            contentHTML += '<ul class="list-none space-y-3">';
            for (const [name, value] of formData.entries()) {
                if (value && value !== '__other_option__') {
                    let labelText = labelMap.get(name) || name;
                    if (name.includes('.other_option_response')) {
                        const baseName = name.replace('.other_option_response', '');
                        labelText = (labelMap.get(baseName) || baseName) + " (‡∏≠‡∏∑‡πà‡∏ô‡πÜ)";
                    }
                    contentHTML += `<li class="border-b pb-2"><strong class="text-indigo-600">${labelText}:</strong><br><span class="pl-2">${value}</span></li>`;
                    count++;
                }
            }
            contentHTML += '</ul>';

            if (count === 0) {
                contentHTML = '<p class="text-center text-gray-500">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>';
            }

            dialog.innerHTML = `<div class="p-6">
                <div class="flex justify-between items-center border-b pb-3 mb-4">
                    <h2 class="text-2xl font-bold theme-accent">‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</h2>
                    <button onclick="this.closest('dialog').close()" class="text-2xl font-bold text-gray-500 hover:text-gray-800">&times;</button>
                </div>
                <div id="previewContent" class="space-y-2 text-gray-700 max-h-[70vh] overflow-y-auto">${contentHTML}</div>
            </div>`;
            dialog.showModal();
        }

        function validateInput(element) {
            const value = parseFloat(element.value);
            const placeholder = element.placeholder || '';
            
            element.classList.remove('input-ok', 'input-warning', 'input-critical');
            if (isNaN(value)) return;

            let match = placeholder.match(/(\d+)\s*-\s*(\d+)/);
            if (match) {
                const min = parseFloat(match[1]);
                const max = parseFloat(match[2]);
                if (value >= min && value <= max) element.classList.add('input-ok');
                else element.classList.add('input-critical');
                return;
            }

            match = placeholder.match(/‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤\s*([\d.]+)/);
            if (match) {
                const min = parseFloat(match[1]);
                if (value >= min) element.classList.add('input-ok');
                else if (value >= min * 0.9) element.classList.add('input-warning');
                else element.classList.add('input-critical');
                return;
            }

            match = placeholder.match(/([\d,]+)/);
            if (match) {
                const std = parseFloat(match[1].replace(/,/g, ''));
                const tolerance = 0.10;
                if (Math.abs(value - std) <= std * tolerance) element.classList.add('input-ok');
                else if (Math.abs(value - std) <= std * (tolerance + 0.05)) element.classList.add('input-warning');
                else element.classList.add('input-critical');
            }
        }

        function analyzeWithAI() {
            const dialog = document.getElementById('aiDialog');
            dialog.innerHTML = `<div class="p-6 md:p-8 bg-slate-50">
                <div class="flex justify-between items-start border-b border-slate-200 pb-4 mb-5">
                    <div class="flex items-center gap-4">
                        <img src="ai_avatar.png" alt="AI Avatar Mekha" class="w-16 h-16 bg-white p-1 rounded-full shadow-lg border-2 theme-accent-border">
                        <div>
                            <h2 class="text-2xl font-bold text-slate-800">AI Engineer "‡πÄ‡∏°‡∏Ü‡∏≤"</h2>
                            <p class="text-slate-500">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡∏•‡∏∂‡∏Å üß†</p>
                        </div>
                    </div>
                    <button onclick="this.closest('dialog').close()" class="text-3xl text-slate-400 hover:text-slate-600 transition-colors">&times;</button>
                </div>
                <div id="aiLoading" class="text-center py-10">
                    <div class="pulse-loader mx-auto"><div></div><div></div><div></div></div>
                    <p class="text-slate-500 mt-4 font-semibold">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
                </div>
                <div id="aiResult" class="hidden space-y-4 max-h-[70vh] overflow-y-auto p-1"></div>
            </div>`;

            const loadingDiv = document.getElementById('aiLoading');
            const resultDiv = document.getElementById('aiResult');
            
            loadingDiv.style.display = 'block';
            resultDiv.classList.add('hidden');
            dialog.showModal();

            const formData = new FormData(inspectionForm);
            const data = {};
            for (const [key, value] of formData.entries()) {
                if (key.includes('.other_option_response')) {
                    const baseKey = key.replace('.other_option_response', '');
                    if (data[baseKey] === '__other_option__') {
                        data[baseKey] = value;
                    }
                } else if (value) {
                    data[key] = value;
                }
            }

            setTimeout(() => {
                const analysisHTML = generateAiAnalysis(data);
                resultDiv.innerHTML = analysisHTML;
                loadingDiv.style.display = 'none';
                resultDiv.classList.remove('hidden');
            }, 1500);
        }
        
        function generateAiAnalysis(data) {
            // This entire function is complex but self-contained. No changes needed.
            // It is kept as is.
            let results = { critical: new Set(), warning: new Set(), ok: new Set(), info: new Set() };
            const getLabel = (name) => {
                const el = document.querySelector(`[name="${name}"]`);
                if (!el) return name;
                const formGroup = el.closest('.form-group');
                return (formGroup && formGroup.querySelector('.form-label')) ? formGroup.querySelector('.form-label').textContent.split('/')[0].trim() : name;
            };

            const rules = {
                'entry.1618028324': { label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô', type: 'radio', conditions: { '‡∏ï‡πà‡∏≥': { severity: 'critical', msg: '‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏≠‡∏≤‡∏à‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ï‡∏≤‡∏°‡∏™‡πÄ‡∏õ‡∏Ñ‡∏ú‡∏π‡πâ‡∏ú‡∏•‡∏¥‡∏ï' } } },
                'entry.14334317': { label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô', type: 'radio', conditions: { '‡∏ï‡πà‡∏≥': { severity: 'critical', msg: '‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏£‡πâ‡∏≠‡∏ô‡∏à‡∏±‡∏î (Overheat) ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏´‡∏•‡πà‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏°' } } },
                'entry.1091386807': { label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏Å‡∏•‡∏±‡πà‡∏ô‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà', type: 'radio', conditions: { '‡∏ï‡πà‡∏≥': { severity: 'warning', msg: '‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ï‡∏¥‡∏°‡∏ô‡πâ‡∏≥‡∏Å‡∏•‡∏±‡πà‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏¢‡∏∑‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà' } } },
                'entry.964120987': { label: '‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á', type: 'numeric', conditions: { check: (val) => val < 50, severity: 'warning', msg: (val) => `‡∏°‡∏µ‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á ${val} ‡∏•‡∏¥‡∏ï‡∏£ ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏≤‡∏ô ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á‡πÉ‡∏´‡πâ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏™‡∏°‡∏≠ (‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 75% ‡∏Ç‡∏≠‡∏á‡∏ñ‡∏±‡∏á)` } },
                'entry.323305993': { label: '‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á', type: 'radio', conditions: { '‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•': { severity: 'critical', msg: '‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏• ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏±‡∏Ñ‡∏Ñ‡∏µ‡∏†‡∏±‡∏¢ ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ' } } },
                'entry.1072480311': { label: '‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô', type: 'radio', conditions: { '‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•': { severity: 'critical', msg: '‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏• ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå' } } },
                'entry.1607591057': { label: '‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô', type: 'radio', conditions: { '‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏•': { severity: 'critical', msg: '‡∏û‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏±‡πà‡∏ß‡πÑ‡∏´‡∏• ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå Overheat ‡πÅ‡∏•‡∏∞‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á‡πÑ‡∏î‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏£‡∏±‡πà‡∏ß‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°' } } },
                'entry.719816448': { label: '‡∏™‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏™‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ô‡πä‡∏≠‡∏ï', type: 'radio', conditions: { '‡∏ô‡πá‡∏≠‡∏ï‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô': { severity: 'warning', msg: '‡∏ï‡∏£‡∏ß‡∏à‡∏û‡∏ö‡∏™‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏ô‡πá‡∏≠‡∏ï‡∏´‡∏•‡∏ß‡∏° ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏ô‡∏™‡∏∞‡πÄ‡∏ó‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏ï‡∏≤‡∏°‡∏°‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏Å‡∏ß‡∏î‡∏Ç‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡∏ô' } } },
                'entry.737194412': { label: '‡∏™‡∏†‡∏≤‡∏û‡∏Ç‡∏≠‡∏á‡∏Ç‡∏±‡πâ‡∏ß‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏ü‡πâ‡∏≤', type: 'radio', conditions: { '‡∏Ç‡∏±‡πâ‡∏ß‡∏™‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡∏ô': { severity: 'warning', msg: '‡∏Ç‡∏±‡πâ‡∏ß‡∏ï‡πà‡∏≠‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏´‡∏•‡∏ß‡∏° ‡∏≠‡∏≤‡∏à‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏™‡∏∞‡∏™‡∏°, ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ï‡∏Å, ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ ‡∏Ñ‡∏ß‡∏£‡∏Å‡∏ß‡∏î‡∏Ç‡∏±‡∏ô‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡∏ô' } } },
                'entry.1182164809': { label: '‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏á‡∏≠‡∏≤‡∏Å‡∏≤‡∏®', type: 'radio', conditions: { '‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏±‡∏ô': { severity: 'warning', msg: '‡∏ï‡∏±‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏ú‡∏™‡∏°‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏Å‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏™‡πà‡∏á‡∏ú‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏Å, ‡∏™‡∏¥‡πâ‡∏ô‡πÄ‡∏õ‡∏•‡∏∑‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á, ‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏ß‡∏±‡∏ô‡∏î‡∏≥ ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà' } } },
                'entry.950885152': { label: '‡πÑ‡∏™‡πâ‡∏Å‡∏£‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô', type: 'radio', conditions: { '‡∏ï‡∏±‡∏ô': { severity: 'warning', msg: '‡∏ï‡∏±‡∏ô ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÄ‡∏û‡∏•‡∏¥‡∏á‡∏ï‡∏Å, ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏î‡∏¥‡∏ô‡πÑ‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏ï‡∏¥‡∏î‡∏¢‡∏≤‡∏Å ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏≤‡∏°‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤' } } },
                'entry.170318696': { label: '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏õ‡∏±‡πä‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', type: 'numeric', tolerance: 0.1, std: 100, msg: (val, std) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (${std} PSI ¬±10%) ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Pressure Switch ‡∏Ç‡∏≠‡∏á Jocky Pump` },
                'entry.835390568': { label: '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏õ‡∏±‡πä‡∏°‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', type: 'numeric_range', min: 120, max: 130, msg: (val, min, max) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (${min}-${max} PSI) ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á Pressure Switch` },
                'entry.1405771031': { label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏£‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå', type: 'numeric', tolerance: 0.1, std: 2300, msg: (val, std) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val} RPM ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (${std} RPM ¬±10%) ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏à‡∏π‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå` },
                'entry.1301900075': { label: '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô', type: 'numeric_range', min: 250, max: 750, msg: (val, min, max) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val} Kpa ‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå (${min}-${max} Kpa) ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ` },
                'entry.1127101964': { label: '‡∏≠‡∏∏‡∏ì‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô', type: 'numeric_range', min: 80, max: 100, msg: (val, min, max) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val}¬∞C ‡∏™‡∏π‡∏á/‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå (${min}-${max}¬∞C) ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏∞‡∏ö‡∏≤‡∏¢‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô` },
                'entry.797055912': { label: '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', type: 'numeric', tolerance: 0.1, std: 99, msg: (val, std) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡πÄ‡∏Å‡∏ì‡∏ë‡πå (${std} PSI ¬±10%) ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á Pressure Switch ‡∏Ç‡∏≠‡∏á Fire Pump` },
                'entry.1506477567': { label: '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏Ç‡∏ì‡∏∞‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', type: 'numeric', tolerance: 0.1, std: 120, msg: (val, std) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå (${std} PSI ¬±10%) ‡∏≠‡∏≤‡∏à‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ‡∏ñ‡∏∂‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡πä‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏£‡∏±‡πà‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö` },
                'entry.628997006': { label: '‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå', type: 'radio', conditions: { '‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥(‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏™‡∏±‡πà‡∏ô‡∏°‡∏≤‡∏Å)': { severity: 'critical', msg: '‡∏™‡∏±‡πà‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á ‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÅ‡∏ó‡πà‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∏‡∏î, ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∏‡∏î‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î/‡∏à‡πà‡∏≤‡∏¢‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÑ‡∏°‡πà‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏≤ ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î' } } },
                'entry.1209254361': { label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á', type: 'radio', conditions: { '‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥': { severity: 'warning', msg: '‡∏°‡∏µ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏Ñ‡∏≤‡∏∞, ‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏´‡∏≠‡∏ô) ‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡πÅ‡∏´‡∏•‡πà‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ô‡∏¥‡∏à‡∏â‡∏±‡∏¢‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏¥‡πà‡∏ô‡πÜ' } } },
                'entry.764561274': { label: '‡∏™‡∏†‡∏≤‡∏û‡∏™‡∏≤‡∏¢‡∏û‡∏≤‡∏ô (‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤)', type: 'radio', conditions: { '‡∏â‡∏µ‡∏Å‡∏Ç‡∏≤‡∏î': { severity: 'critical', msg: '‡∏â‡∏µ‡∏Å‡∏Ç‡∏≤‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏£‡∏≠‡∏¢‡πÅ‡∏ï‡∏Å‡∏£‡πâ‡∏≤‡∏ß‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ç‡∏≤‡∏î‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ' } } },
                'entry.1833812342': { label: '‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≤‡∏£‡πå‡∏à‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà', type: 'numeric_min', min: 12, msg: (val, min) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val}V ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (‡πÑ‡∏°‡πà‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ ${min}V) ‡∏≠‡∏≤‡∏à‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏≤‡∏£‡πå‡∏à‡πÑ‡∏ü ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏î‡∏ä‡∏≤‡∏£‡πå‡∏à` } },
                'entry.1502505224': { label: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà', type: 'numeric_min', min: 12, msg: (val, min) => `‡∏°‡∏µ‡∏Ñ‡πà‡∏≤ ${val}VDC ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô (${min}VDC) ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î‡πÉ‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô ‡∏Ñ‡∏ß‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏ö‡∏ï‡πÄ‡∏ï‡∏≠‡∏£‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà` } },
                'entry.1956843408': { label: '‡∏â‡∏ô‡∏ß‡∏ô‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≤‡∏ß‡∏î‡πå', type: 'radio', conditions: { '‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û': { severity: 'critical', msg: '‡∏â‡∏ô‡∏ß‡∏ô‡∏Ç‡∏≠‡∏á‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡πÄ‡∏™‡∏∑‡πà‡∏≠‡∏°‡∏™‡∏†‡∏≤‡∏û ‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡πÑ‡∏ü‡∏£‡∏±‡πà‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏±‡∏î‡∏ß‡∏á‡∏à‡∏£‡πÑ‡∏î‡πâ ‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏¥‡πà‡∏á ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏¢‡πÑ‡∏ü‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô' } } },
                'entry.498232465': { label: '‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢', type: 'radio', conditions: { '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': { severity: 'critical', msg: '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡πÄ‡∏´‡∏ï‡∏∏' } } },
                'entry.1443945119': { label: '‡∏ü‡∏¥‡∏ß‡∏™‡πå‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô', type: 'radio', conditions: { '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô': { severity: 'critical', msg: '‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏Ç‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏•‡∏±‡∏î‡∏ß‡∏á‡∏à‡∏£‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á' } } },
            };
            const additionalMeasurementRules = {
                'entry.700036978': { label: 'Jocky Pump Start Pressure (Test)', ref_std: 'entry.170318696', type: 'numeric', tolerance: 0.1, msg: (val, std) => `‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ (${std} PSI) ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏ß‡πà‡∏≤ 10% ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥‡∏Ç‡∏≠‡∏á Pressure Switch` },
                'entry.174910325': { label: 'Jocky Pump Stop Pressure (Test)', ref_std: 'entry.835390568', type: 'numeric_range', msg: (val, min, max) => `‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏ô‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ (${min}-${max} PSI) ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡∏ï‡∏±‡πâ‡∏á Pressure Switch` },
                'entry.2077235529': { label: 'Engine Pump Start Pressure (Test)', ref_std: 'entry.797055912', type: 'numeric', tolerance: 0.1, msg: (val, std) => `‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡πÅ‡∏ï‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ (${std} PSI) ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏ß‡πà‡∏≤ 10% ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Pressure Switch ‡∏Ç‡∏≠‡∏á Fire Pump` },
                'entry.491301014': { label: 'Engine Pump Max Pressure (Test)', ref_std: 'entry.1506477567', type: 'numeric_min', msg: (val, std) => `‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ß‡∏±‡∏î‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠ ${val} PSI ‡∏ã‡∏∂‡πà‡∏á‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô (${std} PSI) ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏µ‡∏ô‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏≠‡∏≤‡∏à‡∏ö‡πà‡∏á‡∏ä‡∏µ‡πâ‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏õ‡∏±‡πä‡∏°‡∏•‡∏î‡∏•‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏µ‡∏à‡∏∏‡∏î‡∏£‡∏±‡πà‡∏ß‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î` },
            };

            for (const name in data) {
                const value = data[name];
                if (!value || value === '__other_option__') continue;
                const rule = rules[name];
                if (rule) {
                    if (rule.type === 'radio' && rule.conditions[value]) {
                        const cond = rule.conditions[value];
                        results[cond.severity].add(`<strong>${rule.label}:</strong> ${cond.msg}`);
                    } else {
                        const numVal = parseFloat(value);
                        if (!isNaN(numVal)) {
                            let triggered = false;
                            if (rule.type === 'numeric' && Math.abs(numVal - rule.std) > rule.std * rule.tolerance) {
                                results.warning.add(`<strong>${rule.label}:</strong> ${rule.msg(numVal, rule.std)}`);
                                triggered = true;
                            } else if (rule.type === 'numeric_range' && (numVal < rule.min || numVal > rule.max)) {
                                results.critical.add(`<strong>${rule.label}:</strong> ${rule.msg(numVal, rule.min, rule.max)}`);
                                triggered = true;
                            } else if (rule.type === 'numeric_min' && numVal < rule.min) {
                                results.warning.add(`<strong>${rule.label}:</strong> ${rule.msg(numVal, rule.min)}`);
                                triggered = true;
                            }
                            if (!triggered) results.ok.add(rule.label);
                        }
                    }
                }
                if (typeof value === 'string') {
                    const text = value.toLowerCase();
                    const keywords = { critical: ['‡∏£‡∏±‡πà‡∏ß', '‡∏ã‡∏∂‡∏°', '‡πÅ‡∏ï‡∏Å', '‡∏´‡∏±‡∏Å', '‡∏£‡πâ‡∏≤‡∏ß', '‡∏™‡∏ï‡∏≤‡∏£‡πå‡∏ó‡πÑ‡∏°‡πà‡∏ï‡∏¥‡∏î', '‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô', '‡πÑ‡∏ü‡∏•‡∏∏‡∏Å', '‡πÑ‡∏ü‡πÑ‡∏´‡∏°‡πâ'], warning: ['‡∏´‡∏¢‡πà‡∏≠‡∏ô', '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á', '‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏õ‡∏•‡∏Å', '‡∏™‡∏±‡πà‡∏ô', '‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡∏Å', '‡∏£‡πâ‡∏≠‡∏ô', '‡∏´‡∏•‡∏ß‡∏°', '‡∏Ñ‡∏ß‡∏±‡∏ô‡∏î‡∏≥', '‡∏Ñ‡∏ß‡∏±‡∏ô‡∏Ç‡∏≤‡∏ß'] };
                    if (keywords.critical.some(kw => text.includes(kw))) { results.critical.add(`<strong>${getLabel(name)}:</strong> ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏Å‡∏±‡∏á‡∏ß‡∏• "${value}" ‡∏Ñ‡∏ß‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î`); }
                    else if (keywords.warning.some(kw => text.includes(kw))) { results.warning.add(`<strong>${getLabel(name)}:</strong> ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à "${value}"`); }
                }
                if (name === 'entry.129342865' && value) results.info.add(`<strong>‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö (ISSUE):</strong> ${value}`);
                if (name === 'entry.690163791' && value) results.info.add(`<strong>‡πÅ‡∏ô‡∏ß‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong> ${value}`);
            }

            for (const name in additionalMeasurementRules) {
                const rule = additionalMeasurementRules[name];
                const testValue = parseFloat(data[name]);
                if (isNaN(testValue)) continue;
                if (rule.type === 'numeric') {
                    const stdValue = parseFloat(data[rule.ref_std]);
                    if (!isNaN(stdValue) && Math.abs(testValue - stdValue) > stdValue * rule.tolerance) { results.warning.add(`<strong>${rule.label}:</strong> ${rule.msg(testValue, stdValue)}`); }
                } else if (rule.type === 'numeric_range') {
                    const stdValuePlaceholder = document.querySelector(`[name="${rule.ref_std}"]`)?.placeholder || '';
                    if (stdValuePlaceholder && stdValuePlaceholder.includes('-')) {
                        const match = stdValuePlaceholder.match(/(\d+)\s*-\s*(\d+)/);
                        if (match) { const [min, max] = match.slice(1).map(parseFloat); if (testValue < min || testValue > max) { results.warning.add(`<strong>${rule.label}:</strong> ${rule.msg(testValue, min, max)}`); } }
                    }
                } else if (rule.type === 'numeric_min') {
                    const stdValue = parseFloat(data[rule.ref_std]);
                    if (!isNaN(stdValue) && testValue < stdValue) { results.warning.add(`<strong>${rule.label}:</strong> ${rule.msg(testValue, stdValue)}`); }
                }
            }

            const rpm = parseFloat(data['entry.1405771031']);
            const oilPressure = parseFloat(data['entry.1301900075']);
            if (!isNaN(rpm) && !isNaN(oilPressure) && rpm > 2400 && oilPressure < 300) { results.critical.add(`<strong>‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå:</strong> ‡∏£‡∏≠‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå‡∏™‡∏π‡∏á ‡πÅ‡∏ï‡πà‡πÅ‡∏£‡∏á‡∏î‡∏±‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏´‡∏•‡πà‡∏≠‡∏•‡∏∑‡πà‡∏ô‡∏ï‡πà‡∏≥ ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏†‡∏≤‡∏ß‡∏∞‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏¢‡∏ô‡∏ï‡πå ‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ!`); }

            const critArray = Array.from(results.critical);
            const warnArray = Array.from(results.warning);
            const infoArray = Array.from(results.info);

            let statusCard = (critArray.length > 0) ? `<div class="p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50 border-l-4 border-red-500 ai-analysis-card"><strong class="font-bold">üö® ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏£‡πâ‡∏≤‡∏¢‡πÅ‡∏£‡∏á!</strong> ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏≤‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</div>`
                : (warnArray.length > 0) ? `<div class="p-4 mb-4 text-sm text-amber-800 rounded-lg bg-amber-50 border-l-4 border-amber-500 ai-analysis-card"><strong class="font-bold">‚ö†Ô∏è ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á</strong> ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ ‡πÅ‡∏ï‡πà‡∏Ñ‡∏ß‡∏£‡∏ö‡∏≥‡∏£‡∏∏‡∏á‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï</div>`
                : `<div class="p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50 border-l-4 border-green-500 ai-analysis-card"><strong class="font-bold">‚úÖ ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</strong> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏Å‡∏±‡∏á‡∏ß‡∏•‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>`;
            
            let html = statusCard;
            let counter = 0;
            const createSection = (title, items, icon, colorClass, listType = 'disc') => {
                if (items.length === 0) return '';
                const listStyleClass = listType === 'disc' ? 'list-disc list-inside' : 'list-none';
                let sectionHTML = `<div class="ai-analysis-card ${colorClass}" style="--i: ${counter++};"><div class="p-4 rounded-lg bg-white shadow-sm"><h3 class="text-lg font-bold mb-3 flex items-center gap-2"><i class="${icon}"></i>${title}</h3><ul class="${listStyleClass} text-sm space-y-2 pl-1">`;
                items.forEach(item => { sectionHTML += (listType === 'disc') ? `<li class="flex items-start gap-3"><span class="mt-1.5 w-2 h-2 rounded-full ${colorClass === 'ai-card-critical' ? 'bg-red-500' : (colorClass === 'ai-card-warning' ? 'bg-amber-500' : 'bg-green-500')}"></span><div>${item}</div></li>` : `<li>- ${item}</li>`; });
                sectionHTML += `</ul></div></div>`;
                return sectionHTML;
            };

            html += createSection('‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏£‡πà‡∏á‡∏î‡πà‡∏ß‡∏ô', critArray, 'fa-solid fa-triangle-exclamation', 'ai-card-critical');
            html += createSection('‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥', warnArray, 'fa-solid fa-flag', 'ai-card-warning');
            if (infoArray.length > 0) { html += createSection('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô', infoArray, 'fa-solid fa-pencil', 'ai-card-info', 'none'); }
            if (critArray.length === 0 && warnArray.length === 0) { html += `<div class="text-center p-8 bg-white rounded-lg ai-analysis-card ai-card-ok" style="--i: ${counter};"><i class="fa-solid fa-party-horn text-4xl text-green-500 mb-3"></i><h3 class="text-xl font-bold text-gray-800">‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!</h3><p class="text-gray-500">‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏Å‡∏±‡∏á‡∏ß‡∏• ‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p></div>`; }
            
            return html;
        }

        // --- START THE APP ---
        initializeLogin();
    });
    </script>
</body>
</html>
